function Background(t){const{width:e,height:n,centerY:o}=t,{PI:i,cos:r,sin:c,abs:u,round:s,random:f}=Math,l=.5*i,a=2*i,d=8,h=30*d,g=60*(i/180),S=58,O=.5,C=1,R=100,m=300,p=2,y=6,w=51,E=10;let x,b,T=0,I=!0;const k=document.createElement("canvas"),L=k.getContext("2d");return k.width=e,k.height=n,function(){b=new Float32Array(h);for(let t=0;t<h;t+=d)B(t)}(),{update:function(){T++;for(let t=0;t<h;t+=d)A(t)},render:function(){I&&(x.save(),x.filter="blur(12px)",x.drawImage(k,0,0),x.restore(),x.drawImage(k,0,0))},reset:function(){T=0,k.width=e,k.height=n},show:function(){I=!0},hide:function(){I=!1},setContext:function(t){x=t}};function B(t){const n=U(e),i=s(U(1))?l:a-l,r=O+U(C),c=R+U(m),u=p+U(y),f=w+U(E);b.set([n,o,i,r,0,c,u,f],t)}function A(t){let e=b[t],n=b[t+1],o=b[t+2],i=b[t+3],f=b[t+4],l=b[t+5];!function(t,e,n,o,i,r){L.save();const c=.125*function(t,e){const n=.5*e;return u((t+n)%e-n)/n}(n,o);L.strokeStyle=function(t,e){return`hsla(${t},49%,46%,${e})`}(r,c),L.beginPath(),L.arc(t,e,i,0,a),L.stroke(),L.closePath(),L.restore()}(e,n,f,l,b[t+6],b[t+7]),f++,e+=r(o)*i,n+=c(o)*i;const d=!(T%s(U(S))||s(e)%6&&s(n)%6),h=s(U(1))?-1:1;o+=d?g*h:0,b[t]=e,b[t+1]=n,b[t+2]=o,b[t+4]=f,f>l&&B(t)}function U(t){return t*f()}}function getConfigs(t){const[e,n]=t,o=e/2,i=n/2;return function t(r){const c=Math.round(.618*r);const u=Math.round(.1*c);const s=16*c+8*u;if(s>e)return r=Math.round(.98*r),t(r);const f=`bold ${.618*r}px monospace`;const l=Math.round(.618*c*.618);const a=3*c;const d=a+r;const h=o+c;const g=h+5*c+3*u;const S=o-5*c-3*u;const O=S-3*c-u;const C=Math.round(1.618*r);const R=[{Class:Text,config:{text:"BRING THE NUMBER BACK!",x:o,y:c,color:COLORS.c5,stroke:COLORS.c2,fontSize:c,fontFamily:"Frijole"}},{Class:Text,config:{text:"YOUR GUESS",x:h,y:a,color:COLORS.c4,stroke:COLORS.c2,fontSize:l,fontWeight:"bold",align:"left",fontFamily:"Frijole"}},{Class:Text,config:{text:"ROBOT GUESS",x:o-c,y:a,color:COLORS.c3,stroke:COLORS.c2,fontSize:l,fontWeight:"bold",align:"right",fontFamily:"Frijole"}},{Class:Text,config:{text:"SCORE",x:g,y:a,color:COLORS.c3,stroke:COLORS.c2,fontSize:l,fontWeight:"bold",align:"left",fontFamily:"Frijole"}},{Class:Text,config:{text:"SCORE",x:O+2*c+u,y:a,color:COLORS.c4,stroke:COLORS.c2,fontSize:l,fontWeight:"bold",align:"right",fontFamily:"Frijole"}}];return{width:e,height:n,centerX:o,centerY:i,initBlockY:d,rightBlockX:h,leftBlockX:S,rightBlockX1:g,leftBlockX1:O,stepHeight:C,digitBlockConfig:{dw:c,dh:r,dg:u,df:f},staticItems:R}}(Math.round(n/16))}const COLORS={c1:"#26717F",c2:"#0A4B59",c3:"#B19F3C",c4:"#F2AC29",c5:"#DB5C43"},RESULTS={USER:"You won!.A genuine triumph of the human mind!.Hit Space to beat that piece of metal again",ROBOT:"You lose.Don't sweat.Hit Space to try again.",DRAW:"It's a draw.You almost there.Hit Space to try again.",DUPLICATE_GUESS:"Oops!.You already have this variant.Think harder))",SCORE_ERROR:"Oops!.There is an error in your scores.Hit Space to restart the game."},INPUT_TYPES={GUESS:"guess",SCORE:"score"},EASINGS={IN_CUBIC:"inCubic",OUT_CUBIC:"outCubic",OUT_ELASTIC:"outElastic"};function Game(t,e,n){const{centerX:o,centerY:i,initBlockY:r,rightBlockX:c,leftBlockX:u,rightBlockX1:s,leftBlockX1:f,stepHeight:l,digitBlockConfig:a}=n,d=new Background(n),h=new Robot,g=new ResultDisplay(o,i,a),S=createTexture(a,COLORS.c4,COLORS.c1),O=createTexture(a,COLORS.c3,COLORS.c1);let C,R,m,p,y,w=!0;return{start:function(){C=0,R=[],h.start(),g.reset();const e=h.getGuess();w&&t.add(d);T(e)},toggleAnimation:function(){(w=!w)?d.show():d.hide()}};function E(t){const e=t.join("");if(m(),R.includes(e))k(RESULTS.DUPLICATE_GUESS),p.reset(),I(p,E);else{R.push(e),b(h.getScore(t))}}function x(t){m(),y=t,h.handleScore(t)?k(RESULTS.SCORE_ERROR):T()}function b(e){const n=r+C*l,o=e?s:f,i=e?COLORS.c3:COLORS.c4,c=e?O:S,u=new InputSet(INPUT_TYPES.SCORE,o,n,a,i,c);if(t.add(u),e){u.setDigits(e),1==++C&&t.add(g);const n=function(t){let e=null,n=L(t),o=L(y);o&&n?e=RESULTS.DRAW:o?e=RESULTS.ROBOT:n&&(e=RESULTS.USER);return e}(e);if(n)k(n);else{T(h.getGuess())}}else I(u,x)}function T(e){const n=r+C*l,o=e?u:c,i=e?COLORS.c3:COLORS.c4,s=e?O:S,f=new InputSet(INPUT_TYPES.GUESS,o,n,a,i,s);t.add(f),e?(f.setDigits(e),b()):I(f,E)}function I(t,n){t.activate(n),m=e.subscribe(t.onKey),p=t,d.reset()}function k(e){t.moveToTop(g),g.show(e)}function L(t){return 4===t[0]&&4===t[1]}}function Help(){const t=document.querySelector(".help-outer");let e=!0;return{toggle:function(){e=!e,t.style.display=e?"table":"none"}}}const world=new World,help=new Help,keyboard=new Keyboard,configs=getConfigs(world.getBounds()),game=new Game(world,keyboard,configs);let isFirstRun=!0;function init(){reset(),go()}function go(){game.start(),configs.staticItems.forEach(createStaticItem)}function reset(){world.reset()}function createStaticItem({Class:t,config:e}){const n=new t(e);world.add(n)}function onKey(t){t.isEscape?(isFirstRun&&(isFirstRun=!1,init()),help.toggle()):t.isSpace?init():t.isb&&game.toggleAnimation()}function InputItem(t,e,n,{dw:o,dh:i,dg:r,df:c},u,s,f){const l=e+t*(o+r),a=l+o/2,d=n+i/2,h=300;let g,S="",O=!1,C=!1,R=10*i;return{render:function(){g.fillStyle=O?COLORS.c5:u,g.fillRect(l,n,o,i),C?g.drawImage(f,0,R,o,i,l,n,o,i):(g.fillStyle=s,g.font=c,g.fillText(S,a,d))},setContext:function(t){g=t},setDigit:function(t){S=t,C=!0;const e={dy:R};tween(e,{dy:t*i},h,EASINGS.OUT_ELASTIC,function(){R=e.dy},function(){R=t*i,C=!1})},activate:function(){O=!0},deactivate:function(){O=!1}}}function InputSet(t,e,n,o,i,r){let c,u,s,f,l=null,a=[];const d=t===INPUT_TYPES.SCORE;d?(u=2,s=function(t){return t<=4}):(u=4,s=function(t){return!a.includes(t)});const{bgX:h,bgY:g,bgW:S,bgH:O}=function(t,e,n,{dw:o,dh:i,dg:r}){return{bgX:e-6,bgY:n-6,bgW:t*o+(t-1)*r+12,bgH:i+12}}(u,e,n,o),C=Array.from({length:u},(t,c)=>new InputItem(c,e,n,o,i,COLORS.c1,r));return{render:function(){f.save(),f.fillStyle=COLORS.c1,f.globalAlpha=.618,f.fillRect(h,g,S,O),f.restore(),C.forEach(t=>t.render())},setContext:function(t){f=t,C.forEach(e=>e.setContext(t))},setDigits:function(t){C.forEach((e,n)=>e.setDigit(t[n]))},activate:function(t){c=t,C[l=0].activate()},onKey:function(t){t.isDigit?function(t){if(!s(t))return;const e=a[l];if(a[l]=t,d&&m(a[0])&&m(a[1])&&(4===a[0]&&3===a[1]||!(a[0]>=a[1])))return void(a[l]=e);C[l].setDigit(t),R()}(t.digit):t.isArrowRight?R():t.isArrowLeft?function(){C[l].deactivate(),(l-=1)<0&&(l=u-1);C[l].activate()}():t.isEnter&&a.length===u&&(C[l].deactivate(),l=null,c(a))},reset:function(){a=[],C.forEach(t=>t.setDigit(""))}};function R(){C[l].deactivate(),C[l=(l+1)%u].activate()}function m(t){return Number.isInteger(t)}}function Keyboard(){let t={},e=[];return window.addEventListener("keyup",function(n){const o=Number(n.key),i={};r=n.key," "===r?i.isSpace=!0:!function(t){return Number.isInteger(t)}(o)?i[`is${n.key}`]=!0:(i.digit=o,i.isDigit=!0);var r;e.forEach(e=>t[e]&&t[e](i))}),{subscribe:function(n){const o=Date.now();return t[o]=n,e=Object.keys(t),function(){delete t[o],e=Object.keys(t)}},reset:function(){t={},e=[]}}}function ResultDisplay(t,e,{dw:n,dh:o,df:i}){let r,c="",u="",s="",f=0,l=100;const a=4e3,d=300,h=1200,g=1200,S=`bold ${.618*o*.618}px monospace`,O=16*n,C=4*o,R=t-O/2,m=e-C/2;return{render:function(){c&&(r.save(),r.globalAlpha=f,r.fillStyle=COLORS.c2,r.fillRect(R,m,O,C),r.lineWidth=6,r.strokeStyle=COLORS.c4,r.strokeRect(R,m,O,C),r.save(),l&&(r.filter=`blur(${l}px)`),r.fillStyle=COLORS.c3,r.font=i,r.fillText(c,t,e-o),r.font=S,r.fillText(u,t,e),r.fillText(s,t,e+o),r.restore(),r.restore())},reset:p,setContext:function(t){r=t},show:function(t){[c,u,s]=t.split(".");const e={alpha:0},n={blur:100};tween(e,{alpha:1},d,EASINGS.IN_CUBIC,function(){f=e.alpha},()=>{}),tween(n,{blur:0},h,EASINGS.OUT_CUBIC,function(){l=Math.round(n.blur)},function(){setTimeout(y,a)})},hide:y};function p(){f=0,l=100,c=""}function y(){const t={alpha:1};tween(t,{alpha:0},g,EASINGS.IN_CUBIC,function(){f=t.alpha,l=t.blur},p)}}function Robot(){const t=Array.from(Array(10),(t,e)=>e),e=permutations(t,4);let n,o,i;return{start:function(){n=getRandomItems(4,t),o=[...e]},handleScore:function(t){return 0===(o=reducePermutations(o,i,t[0],t[1])).length},getScore:function(t){return scoreGuess(n,t)},getGuess:function(){return i=pick(o)}}}function reducePermutations(t,e,n,o){const i=[...t];return 0===n?i.filter(function(t){return 0===t.reduce(r,0)}):i.filter(function(t){const[e,i]=t.reduce(c,[0,0]);return e===n&&i===o});function r(t,n){return-1!==e.indexOf(n)&&t++,t}function c(t,n,o){const i=e.indexOf(n);return-1!==i&&(t[0]++,i===o&&t[1]++),t}}function pick(t){return t[Math.floor(Math.random()*t.length)]}function getRandomItems(t,e){return shuffle(e).slice(0,t)}function scoreGuess(t,e){return t.reduce(function(t,n,o){const i=e.indexOf(n);-1!==i&&(t[0]+=1,i===o&&(t[1]+=1));return t},[0,0])}function permutations(t,e){const n=[];return function t(e,i,r=[]){if(r.length===i)n.push(r);else for(let n of e){const c=[...r];c.push(n);const u=o(n,e);t(u,i,c)}}(t,e),n;function o(t,e){return e.filter(e=>e!==t)}}function shuffle(t){for(let e=t.length-1;e>0;e--){const n=Math.floor(Math.random()*(e+1));[t[e],t[n]]=[t[n],t[e]]}return t}function Text({text:t="",fontFamily:e="fantasy",fontSize:n=14,align:o="center",strokeWidth:i=5,color:r,stroke:c,x:u,y:s,fontWeight:f}){let l;const a=`${f?`${f} `:""}${n}px ${e}`;return{render:function(){l.save(),l.font=a,l.textAlign=o,c&&(l.strokeStyle=c,l.lineWidth=i,l.strokeText(t,u,s));l.fillStyle=r,l.fillText(t,u,s),l.restore()},setContext:function(t){l=t},setText:function(e){t=e}}}function createTexture({dw:t,dh:e,df:n},o,i){const r=document.createElement("canvas"),c=r.getContext("2d"),u=t/2;return r.width=t,r.height=11*e,c.textAlign="center",c.textBaseline="middle",c.lineJoin="round",c.font=n,c.fillStyle=o,c.fillRect(0,0,t,r.height),c.fillStyle=i,Array.from({length:11},function(t,n){return{x:u,y:e/2+n*e,t:10===n?"":n}}).forEach(function({x:t,y:e,t:n}){c.fillText(n,t,e)}),r}function tween(t,e,n,o,i,r){const c={},u={},s=new Date,f=Object.keys(e),l={inCubic:function(t,e,n,o){return n*(t/=o)*t*t+e},outCubic:function(t,e,n,o){return n*((t=t/o-1)*t*t+1)+e},outElastic:function(t,e,n,o){let i=1.70158,r=0,c=n;return 0===t?e:1==(t/=o)?e+n:(r||(r=.3*o),c<Math.abs(n)?(c=n,i=r/4):i=r/(2*Math.PI)*Math.asin(n/c),c*Math.pow(2,-10*t)*Math.sin((t*o-i)*(2*Math.PI)/r)+n+e)}}[o];function a(e){f.forEach(o=>{t[o]=l(e,c[o],u[o],n)})}f.forEach(n=>{c[n]=t[n],u[n]=e[n]-c[n]}),function t(){let e=new Date-s;e<n?(a(e),i(),requestAnimationFrame(t)):(a(e=n),r())}()}function World(){const t=document.querySelector("canvas"),e=t.getContext("2d"),n=.3;let o=[],i=[],r=performance.now();return t.width=window.innerWidth,t.height=window.innerHeight,e.textAlign="center",e.textBaseline="middle",e.lineJoin="round",{getBounds:function(){return[t.width,t.height]},moveToTop:function(t){(o=o.filter(e=>e!==t)).push(t)},add:function(t){t.setContext(e),o.push(t),"function"==typeof t.update&&i.push(t)},remove:function(t){o=o.filter(e=>e!==t),i=i.filter(e=>e!==t)},reset:function(){o=[],i=[],c(r=performance.now())}};function c(u){const s=u-r;!function(t){i.forEach(e=>e.update(t))}(u),s>n&&(r=u,e.clearRect(0,0,t.width,t.height),o.forEach(t=>t.render())),requestAnimationFrame(c)}}keyboard.subscribe(onKey);