function getConfigs(t){const[e,n]=t,o=e/2,i=n/2;return function t(c){const r=Math.round(.618*c);const s=Math.round(.1*r);const u=16*r+8*s;if(u>e)return c=Math.round(.98*c),t(c);const l=`bold ${.618*c}px monospace`;const a=Math.round(.618*r);const f=3*r;const d=f+c;const h=o+r;const S=h+5*r+3*s;const g=o-5*r-3*s;const O=g-3*r-s;const C=Math.round(1.618*c);const p=[{Class:Text,config:{text:"BRING THE NUMBER BACK!",x:o,y:r,color:COLORS.c5,stroke:COLORS.c2,fontSize:r,fontFamily:"fantasy"}},{Class:Text,config:{text:"YOUR GUESS",x:h,y:f,color:COLORS.c4,stroke:COLORS.c2,fontSize:a,fontWeight:"bold",align:"left",fontFamily:"system-ui"}},{Class:Text,config:{text:"ROBOT GUESS",x:o-r,y:f,color:COLORS.c3,stroke:COLORS.c2,fontSize:a,fontWeight:"bold",align:"right",fontFamily:"system-ui"}},{Class:Text,config:{text:"SCORE",x:S,y:f,color:COLORS.c3,stroke:COLORS.c2,fontSize:a,fontWeight:"bold",align:"left",fontFamily:"system-ui"}},{Class:Text,config:{text:"SCORE",x:O+2*r+s,y:f,color:COLORS.c4,stroke:COLORS.c2,fontSize:a,fontWeight:"bold",align:"right",fontFamily:"system-ui"}}];return{width:e,height:n,centerX:o,centerY:i,initBlockY:d,rightBlockX:h,leftBlockX:g,rightBlockX1:S,leftBlockX1:O,stepHeight:C,digitBlockConfig:{dw:r,dh:c,dg:s,df:l},staticItems:p}}(Math.round(n/16))}const COLORS={c1:"#26717F",c2:"#0A4B59",c3:"#B19F3C",c4:"#F2AC29",c5:"#DB5C43"},RESULTS={USER:"You won!.A genuine triumph of the human mind!.Hit Space to beat that piece of metal again",ROBOT:"You lose.Don't sweat.Hit Space to try again.",DRAW:"It's a draw.You almost there.Hit Space to try again.",DUPLICATE_GUESS:"Oops!.You already have this variant.Think harder))",SCORE_ERROR:"Oops!.There is an error in your scores.Hit Space to restart the game."},INPUT_TYPES={GUESS:"guess",SCORE:"score"},EASINGS={IN_CUBIC:"inCubic",OUT_CUBIC:"outCubic",OUT_ELASTIC:"outElastic"};function Game(t,e,n){const{centerX:o,centerY:i,initBlockY:c,rightBlockX:r,leftBlockX:s,rightBlockX1:u,leftBlockX1:l,stepHeight:a,digitBlockConfig:f}=n,d=new Robot,h=new ResultDisplay(o,i,f),S=createTexture(f,COLORS.c4,COLORS.c1),g=createTexture(f,COLORS.c3,COLORS.c1);let O,C,p,R,y;return{start:function(){O=0,C=[],d.start(),h.reset(),x(d.getGuess())}};function m(t){const e=t.join("");if(p(),C.includes(e))I(RESULTS.DUPLICATE_GUESS),R.reset(),T(R,m);else{C.push(e),w(d.getScore(t))}}function E(t){p(),y=t,d.handleScore(t)?I(RESULTS.SCORE_ERROR):x()}function w(e){const n=c+O*a,o=e?u:l,i=e?COLORS.c3:COLORS.c4,r=e?g:S,s=new InputSet(INPUT_TYPES.SCORE,o,n,f,i,r);if(t.add(s),e){s.setDigits(e),1==++O&&t.add(h);const n=function(t){let e=null,n=b(t),o=b(y);o&&n?e=RESULTS.DRAW:o?e=RESULTS.ROBOT:n&&(e=RESULTS.USER);return e}(e);if(n)I(n);else{x(d.getGuess())}}else T(s,E)}function x(e){const n=c+O*a,o=e?s:r,i=e?COLORS.c3:COLORS.c4,u=e?g:S,l=new InputSet(INPUT_TYPES.GUESS,o,n,f,i,u);t.add(l),e?(l.setDigits(e),w()):T(l,m)}function T(t,n){t.activate(n),p=e.subscribe(t.onKey),R=t}function I(e){t.moveToTop(h),h.show(e)}function b(t){return 4===t[0]&&4===t[1]}}function InputItem(t,e,n,{dw:o,dh:i,dg:c,df:r},s,u,l){const a=e+t*(o+c),f=a+o/2,d=n+i/2,h=300;let S,g="",O=!1,C=!1,p=10*i;return{render:function(){S.fillStyle=O?COLORS.c5:s,S.fillRect(a,n,o,i),C?S.drawImage(l,0,p,o,i,a,n,o,i):(S.fillStyle=u,S.font=r,S.fillText(g,f,d))},setContext:function(t){S=t},setDigit:function(t){g=t,C=!0;const e={dy:p};tween(e,{dy:t*i},h,EASINGS.OUT_ELASTIC,function(){p=e.dy},function(){p=t*i,C=!1})},activate:function(){O=!0},deactivate:function(){O=!1}}}function InputSet(t,e,n,o,i,c){let r,s,u,l=null,a=[];const f=t===INPUT_TYPES.SCORE;f?(s=2,u=function(t){return t<=4}):(s=4,u=function(t){return!a.includes(t)});const d=Array.from({length:s},(t,r)=>new InputItem(r,e,n,o,i,COLORS.c1,c));return{render:function(){d.forEach(t=>t.render())},setContext:function(t){d.forEach(e=>e.setContext(t))},setDigits:function(t){d.forEach((e,n)=>e.setDigit(t[n]))},activate:function(t){r=t,d[l=0].activate()},onKey:function(t){t.isDigit?function(t){if(!u(t))return;const e=a[l];if(a[l]=t,f&&S(a[0])&&S(a[1])&&(4===a[0]&&3===a[1]||!(a[0]>=a[1])))return void(a[l]=e);d[l].setDigit(t),h()}(t.digit):t.isArrowRight?h():t.isArrowLeft?function(){d[l].deactivate(),(l-=1)<0&&(l=s-1);d[l].activate()}():t.isEnter&&a.length===s&&(d[l].deactivate(),l=null,r(a))},reset:function(){a=[],d.forEach(t=>t.setDigit(""))}};function h(){d[l].deactivate(),d[l=(l+1)%s].activate()}function S(t){return Number.isInteger(t)}}function Keyboard(){let t={},e=[];return window.addEventListener("keyup",function(n){const o=Number(n.key),i={};c=n.key," "===c?i.isSpace=!0:!function(t){return Number.isInteger(t)}(o)?i[`is${n.key}`]=!0:(i.digit=o,i.isDigit=!0);var c;e.forEach(e=>t[e](i))}),{subscribe:function(n){const o=Date.now();return t[o]=n,e=Object.keys(t),function(){delete t[o],e=Object.keys(t)}},removeAll:function(){t={},e=[]}}}const world=new World,help=document.querySelector(".help-outer"),keyboard=new Keyboard,configs=getConfigs(world.getBounds()),game=new Game(world,keyboard,configs);let isFirstRun=!0,isHelpShown=!0;function init(){keyboard.removeAll(),keyboard.subscribe(onKey),world.reset(),configs.staticItems.forEach(createStaticItem),game.start()}function createStaticItem({Class:t,config:e}){const n=new t(e);world.add(n)}function onKey(t){t.isEscape?(isFirstRun&&(isFirstRun=!1,init()),toggleHelp()):t.isSpace&&init()}function toggleHelp(){isHelpShown=!isHelpShown,help.style.display=isHelpShown?"table":"none"}function ResultDisplay(t,e,{dw:n,dh:o,df:i}){let c,r="",s="",u="",l=0,a=0;const f=4e3,d=300,h=1200,S=1200,g=`bold ${.618*o*.618}px monospace`,O=16*n,C=4*o,p=t-O/2,R=e-C/2;return{render:function(){r&&(c.save(),c.globalAlpha=l,c.fillStyle=COLORS.c2,c.fillRect(p,R,O,C),c.lineWidth=6,c.strokeStyle=COLORS.c4,c.strokeRect(p,R,O,C),c.globalAlpha=a,c.fillStyle=COLORS.c3,c.font=i,c.fillText(r,t,e-o),c.font=g,c.fillText(s,t,e),c.fillText(u,t,e+o),c.restore())},reset:y,setContext:function(t){c=t},show:function(t){[r,s,u]=t.split(".");const e={alpha:0};tween(e,{alpha:1},d,EASINGS.IN_CUBIC,function(){l=e.alpha},()=>{}),tween({alpha1:0},{alpha1:1},h,EASINGS.OUT_CUBIC,function(){a=e.alpha1},function(){setTimeout(m,f)})},hide:m};function y(){l=0,a=0,r=""}function m(){const t={alpha:1,alpha1:1};tween(t,{alpha:0,alpha1:0},S,EASINGS.IN_CUBIC,function(){l=t.alpha,a=t.alpha1},y)}}function Robot(){const t=Array.from(Array(10),(t,e)=>e),e=permutations(t,4);let n,o,i;return{start:function(){n=getRandomItems(4,t),console.log("robot secret is ",n),o=[...e];const i=getRandomItems(4,t).join("");console.log("your secret is ",i)},handleScore:function(t){return 0===(o=reducePermutations(o,i,t[0],t[1])).length},getScore:function(t){return scoreGuess(n,t)},getGuess:function(){return i=pick(o)}}}function reducePermutations(t,e,n,o){const i=[...t];return 0===n?i.filter(function(t){return 0===t.reduce(c,0)}):i.filter(function(t){const[e,i]=t.reduce(r,[0,0]);return e===n&&i===o});function c(t,n){return-1!==e.indexOf(n)&&t++,t}function r(t,n,o){const i=e.indexOf(n);return-1!==i&&(t[0]++,i===o&&t[1]++),t}}function pick(t){return t[Math.floor(Math.random()*t.length)]}function getRandomItems(t,e){return shuffle(e).slice(0,t)}function scoreGuess(t,e){return t.reduce(function(t,n,o){const i=e.indexOf(n);-1!==i&&(t[0]+=1,i===o&&(t[1]+=1));return t},[0,0])}function permutations(t,e){const n=[];return function t(e,i,c=[]){if(c.length===i)n.push(c);else for(let n of e){const r=[...c];r.push(n);const s=o(n,e);t(s,i,r)}}(t,e),n;function o(t,e){return e.filter(e=>e!==t)}}function shuffle(t){for(let e=t.length-1;e>0;e--){const n=Math.floor(Math.random()*(e+1));[t[e],t[n]]=[t[n],t[e]]}return t}function Text({text:t="",fontFamily:e="fantasy",fontSize:n=14,align:o="center",strokeWidth:i=5,color:c,stroke:r,x:s,y:u,fontWeight:l}){let a;const f=`${l?`${l} `:""}${n}px ${e}`;return{render:function(){a.save(),a.font=f,a.textAlign=o,r&&(a.strokeStyle=r,a.lineWidth=i,a.strokeText(t,s,u));a.fillStyle=c,a.fillText(t,s,u),a.restore()},setContext:function(t){a=t},setText:function(e){t=e}}}function createTexture({dw:t,dh:e,df:n},o,i){const c=document.createElement("canvas"),r=c.getContext("2d"),s=t/2;return c.width=t,c.height=11*e,r.textAlign="center",r.textBaseline="middle",r.lineJoin="round",r.font=n,r.fillStyle=o,r.fillRect(0,0,t,c.height),r.fillStyle=i,Array.from({length:11},function(t,n){return{x:s,y:e/2+n*e,t:10===n?"":n}}).forEach(function({x:t,y:e,t:n}){r.fillText(n,t,e)}),c}function tween(t,e,n,o,i,c){const r={},s={},u=new Date,l=Object.keys(e),a={inCubic:function(t,e,n,o){return n*(t/=o)*t*t+e},outCubic:function(t,e,n,o){return n*((t=t/o-1)*t*t+1)+e},outElastic:function(t,e,n,o){let i=1.70158,c=0,r=n;return 0===t?e:1==(t/=o)?e+n:(c||(c=.3*o),r<Math.abs(n)?(r=n,i=c/4):i=c/(2*Math.PI)*Math.asin(n/r),r*Math.pow(2,-10*t)*Math.sin((t*o-i)*(2*Math.PI)/c)+n+e)}}[o];function f(e){l.forEach(o=>{t[o]=a(e,r[o],s[o],n)})}l.forEach(n=>{r[n]=t[n],s[n]=e[n]-r[n]}),function t(){let e=new Date-u;e<n?(f(e),i(),requestAnimationFrame(t)):(f(e=n),c())}()}function World(){const t=document.querySelector("canvas"),e=t.getContext("2d"),n=.3;let o=[],i=[],c=performance.now();return t.width=window.innerWidth,t.height=window.innerHeight,e.textAlign="center",e.textBaseline="middle",e.lineJoin="round",{getBounds:function(){return[t.width,t.height]},moveToTop:function(t){(o=o.filter(e=>e!==t)).push(t)},add:function(t){t.setContext(e),o.push(t),"function"==typeof t.update&&i.push(t)},reset:function(){o=[],i=[],r(c=performance.now())}};function r(s){const u=s-c;!function(t){i.forEach(e=>e.update(t))}(s),u>n&&(c=s,e.clearRect(0,0,t.width-10,t.height-10),o.forEach(t=>t.render())),requestAnimationFrame(r)}}keyboard.subscribe(onKey);
//# sourceMappingURL=g.js.map
